---
title: "Use dictionary"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cerulean
    toc: yes
  pdf_document:
    toc: yes
#output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualising the gdpm package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This package contains a dictionary for Vietnamese provinces names, districts names and communes names, useful to ensure consistency between different data packages using Vietnamese provinces, districts and/or communes. It also contains dictionaries for the Camdodian, Lao and Thai provinces names and Lao districts.
The package also contains the list names of the provinces ordered by year. These lists contain for each of change, the name of the "new" provinces in English. We also have a list by country (Vietnam, Laos, Cambodge, Thailand) of the history of change in administrative boundaries


```{r eval=F}
devtools::install_github("choisy/dictionary")
```

Loading and attaching the `dictionary` package:

```{r}
library(dictionary)
```

# Usage examples

## Dictionnary

We can use some examples to demonstrate our package: 

### Communes

We create a vector containing some communes names in Vietnamese:

```{r}
communes_vn <- c("Xã Nghĩa Lợi", "Xã Nam Mẫu", "Xã Xuân Vinh",
                 "Thị trấn Thứ Ba", "Xã Hải Dương", "Xã Vĩnh Lộc A",
                 "Xã Nội Hoàng", "Xã Điện Trung", "Xã Hoàng Đồng", "Xã Nàn Sán")
```

We can use the `character vector` `communes` to translate the Vietnamese vector but first the vector should be encode in UNICODE to avoid encoding trouble. For that, we use the `stringi` package:

```{r}
uni_communes_vn <- stringi::stri_escape_unicode(communes_vn)
```

And now, we can use the vector `communes`

```{r}
commune_transl <- communes[uni_communes_vn]
```

We obtain a `character vector`, with the original names as `name` and the translation as `value`:   

```{r}
str(commune_transl)
commune_transl
```

### Districts and Provinces

Each dictionary is a names vector:

```{r}
# For Vietnam:
str(vn_province)
str(vn_district)
# For Laos:
str(la_province)
str(la_district)
# For Cambodge:
str(kh_province)
# For Thailand:
str(th_province)
```

To use them, it's the same principle for the provinces and the districts:
We create two vectors that needed to be translate: 

```{r}
districts_vn <- c("Huyện Tây Hòa", "Huyện Kim Thành", "Quận Liên Chiểu",
                  "Huyện Tương Dương", "Huyện Bình Đại",
                  "Thị xã Mường Lay", "Thành phố Vĩnh Long",
                  "Huyện Gia Viễn", "Huyện Văn Quan", "Thị xã Sông Công")
provinces_vn <- c("Ninh Bình", "Hà Nội", "An Giang", "Bình Phước", "Lào Cai",
                  "Phú Thọ", "Bắc Giang", "Vĩnh Phúc", "Bạc Liêu", "Hà Giang")
```

But, we use the `character vector` `districts` and `provinces` contains in the package to translate the two vectors after changing the encoding to UNICODE:

```{r}
uni_districts_vn <- stringi::stri_escape_unicode(districts_vn)
uni_provinces_vn <- stringi::stri_escape_unicode(provinces_vn)
```

```{r}
district_transl <- vn_district[uni_districts_vn]
province_transl <- vn_province[uni_provinces_vn]
```

We obtain two `character vectors`, with the original names as `name` and the translation as `value`:

```{r}
str(district_transl)
district_transl
str(province_transl)
province_transl
```

## List of province per year

It's a `list` object : 

```{r}
str(vn_province_year)
```

To see a particular year (for example 1997) :

```{r}
vn_province_year$`1997`
```

## History

The package contains also a list by country of the history of change in administrative boundaries: 

```{r}
str(th_history)
```

It's List of 2 lists containing 4 or 6 elements, depending of the event. If the history contains `complex` event, meaning some splits or merges events where the districts are detailed, two slots with these detailed are added :

* `year`: date of event in character in format "YYYY-mm-dd"
* `event`: character vector of one object either split, merge, complex split, complex merge or rename
* `before`: list of name of the province(s) before the event
* `after`: list of name of the province(s) after the event
* `d.before`: details of the previous districts in the province associated concerned by the complex event
* `d.after`: details of the districts in the province associated concerned after the complex event 
  
For example, the Laos history contains complex event:
```{r}
la_history
```

## Function

In the package, the function `match_pattern` with the `XX_province_year` can be used to return the year of expression of the province in a data frame.

For example, if we use a data frame containing data expressed by province: 
```{r}
data <- data.frame(
  province = unique(grep("Xaisomboun", la_province, value = TRUE, invert = TRUE)),
  value = sample(1:3, length(unique(la_province)[-1]), T))
head(data)
```

We can now, used the `match_pattern` function:
```{r}
match_pattern(data, "province", la_province_year)
# the data are expressed with the province definition of 2006
```
